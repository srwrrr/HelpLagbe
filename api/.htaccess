# .htaccess file for API directory

# Enable URL rewriting
RewriteEngine On

# Route /api/... to /helplagbe/api/...
RewriteRule ^api/(.*)$ helplagbe/api/$1 [L]

# Set proper headers for CORS
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"

# Handle CORS preflight requests
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# API Routes
RewriteRule ^auth/login/?$ auth/login.php [L]
RewriteRule ^auth/register/?$ auth/register.php [L]
RewriteRule ^auth/technician-register/?$ auth/technician-register.php [L]
RewriteRule ^auth/logout/?$ auth/logout.php [L]
RewriteRule ^auth/check-session/?$ auth/check-session.php [L]
RewriteRule ^auth/profile/?$ auth/profile.php [L]

# Posts routes
RewriteRule ^posts/create/?$ posts/create.php [L]
RewriteRule ^posts/user-posts/?$ posts/user-posts.php [L]
RewriteRule ^posts/available-tasks/?$ posts/available-tasks.php [L]
RewriteRule ^posts/history/?$ posts/history.php [L]
RewriteRule ^posts/([0-9]+)/?$ posts/post.php?post_id=$1 [L]
RewriteRule ^posts/([0-9]+)/bids/?$ posts/bids.php?post_id=$1 [L]

# Bids routes
RewriteRule ^bids/submit/?$ bids/submit.php [L]
RewriteRule ^bids/([0-9]+)/accept/?$ bids/accept.php?bid_id=$1 [L]

# Tasks routes
RewriteRule ^tasks/my-tasks/?$ tasks/my-tasks.php [L]
RewriteRule ^tasks/([0-9]+)/status/?$ tasks/status.php?task_id=$1 [L]

# Services routes
RewriteRule ^services/rate/?$ services/rate.php [L]

# Admin routes
RewriteRule ^admin/login/?$ admin/login.php [L]
RewriteRule ^admin/stats/?$ admin/stats.php [L]
RewriteRule ^admin/users/?$ admin/users.php [L]
RewriteRule ^admin/technicians/?$ admin/technicians.php [L]
RewriteRule ^admin/posts/?$ admin/posts.php [L]
RewriteRule ^admin/tasks/?$ admin/tasks.php [L]
RewriteRule ^admin/pending-approvals/?$ admin/pending-approvals.php [L]
RewriteRule ^admin/approve-application/?$ admin/approve-application.php [L]
RewriteRule ^admin/reject-application/?$ admin/reject-application.php [L]
RewriteRule ^admin/recent-activities/?$ admin/recent-activities.php [L]

# Set proper headers
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"

# Error handling
ErrorDocument 404 /api/error/404.php
ErrorDocument 500 /api/error/500.php